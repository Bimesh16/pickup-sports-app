import{u as y,r as s,j as t,C as S,i as l,y as j}from"./index-5gA1ZPbL.js";const c={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};function N(){const d=y(),[r,p]=s.useState(""),[u,n]=s.useState(null),[h,m]=s.useState(!1),[o,b]=s.useState(null),f=s.useMemo(()=>{const e=Object.values(j);if(!r.trim())return e;const a=r.toLowerCase();return e.filter(i=>i.name.toLowerCase().includes(a))},[r]),g=async e=>{try{localStorage.setItem("ps_user_location",JSON.stringify(e))}catch{}try{const a=localStorage.getItem("ps_token"),i=(c==null?void 0:c.VITE_API_BASE)||"http://localhost:8080",x=(await fetch(`${i}/profiles/me`,{headers:{Authorization:a?`Bearer ${a}`:""}})).headers.get("etag")||void 0;await fetch(`${i}/profiles/me`,{method:"PUT",headers:{"Content-Type":"application/json",...x?{"If-Match":x}:{},Authorization:a?`Bearer ${a}`:""},body:JSON.stringify({location:e.name})})}catch{}d("/dashboard")};return t.jsx("div",{className:"min-h-screen grid place-items-center bg-gradient-to-br from-nepal-blue via-slate-900 to-nepal-crimson p-4 text-white",children:t.jsxs(S,{padding:"lg",style:{width:640,maxWidth:"100%"},children:[t.jsx("h1",{className:"text-2xl font-bold mb-1",children:"Choose your location"}),t.jsx("p",{className:"text-sm text-white/80 mb-4",children:"Use your current location or pick a city to personalize games near you."}),u&&t.jsx("div",{className:"mb-3 rounded-md bg-red-50 p-2 text-sm text-red-700",children:u}),t.jsxs("div",{className:"flex gap-2 mb-3",children:[t.jsx(l,{onClick:()=>{if(!navigator.geolocation){n("Geolocation not supported.");return}m(!0),n(null),navigator.geolocation.getCurrentPosition(e=>g({lat:e.coords.latitude,lng:e.coords.longitude,name:"Your Location"}),()=>{m(!1),n("Permission blocked. Reset in Site Info or pick a city below.")},{enableHighAccuracy:!0,timeout:8e3})},disabled:h,children:h?"Detectingâ€¦":"Use my location"}),t.jsx("input",{className:"flex-1 rounded-lg border border-white/20 bg-white/10 px-3 py-2 text-sm placeholder-white/60",placeholder:"Search a city (e.g., Kathmandu)",value:r,onChange:e=>p(e.target.value)})]}),t.jsx("div",{className:"max-h-64 overflow-y-auto rounded-lg border border-white/10",children:f.map(e=>t.jsxs("button",{onClick:()=>b(e),className:`w-full text-left px-3 py-2 text-sm ${(o==null?void 0:o.name)===e.name?"bg-white/10":"hover:bg-white/5"}`,children:[e.name,t.jsxs("span",{className:"text-white/60",children:[" (",e.lat.toFixed(4),", ",e.lng.toFixed(4),")"]})]},e.name))}),t.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[t.jsx(l,{variant:"outline",onClick:()=>d("/dashboard"),children:"Skip"}),t.jsx(l,{onClick:()=>{o?g(o):n("Select a city or use your location.")},children:"Save"})]})]})})}export{N as default};
